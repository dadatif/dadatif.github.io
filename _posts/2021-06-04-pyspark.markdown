---
layout: posts
title:  "pyspark"
date:   2021-06-04 21:02:13 +0200
categories: jekyll update
---


count:

``` python
df.count()
```

count distinct:

```python
df.select(F.countDistinct("mycol")).collect()[0][0]
```

groupby and count, mean, max, min, avg, percentile, quantile, median

```python
df.groupby('col1','col2').agg(
  F.count("col3").alias("col3_count"),
  F.min("col3").alias("col3_min"),
  F.max("col3").alias("col3_max"),
  F.avg("col3").alias("col3_avg"),
)
```



array agg

```python
df.groupBy('col1').agg(F.collect_list('col2').alias('col2_array'))
```



Array_sort, array_distinct array_agg

```python
df.groupBy('col1').agg(
	F.array_sort(F.array_distinct(F.collect_list('col2'))).alias('col2_array')
)

# equivalent using expr
df.groupBy('col1').agg(
	F.expr('array_sort(array_distinct(collect_list(col2))) as col2_array')
)
```



query a dataframe

```
df.createOrReplaceTempView("my_table")
df2 = dss.reader.read_with_spark_sql("select * from my_table")
```

